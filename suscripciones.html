<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Suscr√≠bete a IA Alfa y elige el plan que mejor se adapte a tus necesidades para crecer en el mundo empresarial.">
  <title>Suscripciones - IA Alfa</title>
  <link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lottie-web@latest/build/player/lottie.min.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* RESET GENERAL */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
html {
  scroll-behavior: smooth;
}

/* FUENTE Y FONDO ANIMADO */
html, body {
  height: 100%;
  font-family: 'Maven Pro', sans-serif;
  background: linear-gradient(135deg, #0e162e, #1c2541, #3a506b, #5bc0be);
  background-size: 400% 400%;
  animation: fondoElegante 30s ease infinite;
  color: white;
}

@keyframes fondoElegante {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* HEADER */
header, main, footer {
  padding: 20px;
}

header {
  text-align: center;
  margin-top: 40px;
}

header h1 {
  font-size: 32px;
}

.subtitulo {
  margin-top: 10px;
  font-size: 16px;
  opacity: 0.8;
}

/* PLANES */
.planes-container {
  display: flex;
  justify-content: center;
  gap: 30px;
  flex-wrap: wrap;
  padding: 50px 20px;
}

.plan {
  background: rgba(255,255,255,0.05);
  border-radius: 16px;
  padding: 30px;
  width: 300px;
  min-height: 540px;
  backdrop-filter: blur(8px);
  box-shadow: 0 0 15px rgba(0,0,0,0.3);
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  position: relative;
  opacity: 0;
  transform: translateY(30px);
  animation: fadeInUp 1s forwards;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.plan:nth-child(2) { animation-delay: 0.2s; }
.plan:nth-child(3) { animation-delay: 0.4s; }

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.plan:hover {
  transform: translateY(-10px);
  box-shadow: 0 0 25px rgba(255,255,255,0.1);
}

.plan.recomendado {
  border: 2px solid #FFC107;
  box-shadow: 0 0 25px rgba(255,193,7,0.4);
}

.etiqueta {
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #FFC107;
  color: black;
  font-weight: bold;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
}

.plan h2 {
  font-size: 24px;
  margin: 10px 0;
}

.plan .precio {
  font-size: 28px;
  margin-bottom: 15px;
  font-weight: bold;
}

.plan ul {
  list-style: none;
  padding: 0;
  margin-bottom: 20px;
}

.plan ul li {
  margin: 10px 0;
  font-size: 14px;
}

.plan button {
  padding: 10px 20px;
  border: none;
  border-radius: 25px;
  font-weight: bold;
  background: linear-gradient(135deg, #2c3e50, #6a89cc);
  color: white;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.3s ease;
}

.plan button:hover {
  background: linear-gradient(135deg, #6a89cc, #2c3e50);
  transform: scale(1.05);
}

/* BARRA DE POPULARIDAD */
.barra-popularidad {
  height: 6px;
  width: 100%;
  background: rgba(255,255,255,0.1);
  border-radius: 10px;
  overflow: hidden;
  margin-top: 10px;
}

.barra-popularidad .progreso {
  height: 100%;
  background: #FFC107;
}

/* BOT√ìN DE INICIO */
.btn-inicio {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(255,255,255,0.1);
  padding: 10px 15px;
  border-radius: 10px;
  color: white;
  text-decoration: none;
  backdrop-filter: blur(5px);
  font-weight: bold;
  box-shadow: 0 0 10px rgba(255,255,255,0.1);
  z-index: 10;
}

/* AVATAR ANIMADO */
.alfa-avatar {
  position: fixed;
  bottom: 20px;
  right: 20px;
  text-align: center;
  animation: float 4s ease-in-out infinite;
  z-index: 2;
}

.alfa-bubble {
  background: rgba(0,0,0,0.4);
  padding: 10px 18px;
  border-radius: 20px;
  color: white;
  margin-bottom: 10px;
  max-width: 260px;
  font-size: 14px;
  backdrop-filter: blur(6px);
  box-shadow: 0 0 10px rgba(255,255,255,0.1);
}

#avatarAnimacion {
  width: 100px;
  height: 100px;
}

@keyframes float {
  0% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0); }
}

/* FONDO LOTTIE */
#lottieFondo {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  opacity: 0.05;
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .planes-container {
    flex-direction: column;
    align-items: center;
  }
  .plan {
    width: 90%;
    margin-bottom: 30px;
  }
}

/* MODAL DE PAGO */
.modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 20;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease;
}

.modal.show {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: #1c2541;
  padding: 30px;
  border-radius: 10px;
  max-width: 420px;
  width: 100%;
  color: white;
  text-align: left;
}

.modal-content label {
  font-weight: 600;
  margin-top: 10px;
  display: block;
}

.modal-content input,
.modal-content select {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  background: #1f2937;
  border: 1px solid #374151;
  border-radius: 6px;
  color: white;
  font-size: 14px;
}

.modal-content .info {
  background: #111827;
  border-left: 4px solid #4b5563;
  padding: 12px;
  font-size: 13px;
  border-radius: 6px;
  margin-bottom: 20px;
  opacity: 0.9;
}

.modal-content .cancelar,
.modal-content .continuar {
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  font-size: 15px;
  cursor: pointer;
}

.modal-content .cancelar {
  background: #374151;
  color: white;
}

.modal-content .cancelar:hover {
  background: #4b5563;
}

.modal-content .continuar {
  background: #10b981;
  color: white;
}

.modal-content .continuar:hover {
  background: #059669;
}


  </style>
</head>
<body>

  <!-- Fondo animado Lottie -->
  <div id="lottieFondo"></div>
  
  <!-- Bot√≥n "Inicio" flotante -->
  <a href="index.html" class="btn-inicio" aria-label="Volver al inicio">‚¨Ö Inicio</a>


    <!-- Encabezado -->
  <header>
    <h1>Elige tu plan de suscripci√≥n</h1>
  </header>

  <!-- Contenedor principal de planes -->
  <main class="planes-container">
    <!-- Plan 2 Meses -->
    <article class="plan" aria-label="Plan 2 Meses">
      <h2>Plan 2 Meses</h2>
      <div class="precio">$1000 / 2 meses</div>
      <ul>
         <li>‚úÖ Acceso a base de datos en la nube</li>
      <li>‚ö° 10 GB de almacenamiento</li>
      <li>üîí Seguridad est√°ndar</li>
      <li>üì° Conexi√≥n API disponible</li>
      <li>üìä Panel de control b√°sico</li>
      <li>üë• 2 usuarios administradores incluidos</li>
      <li>üõ†Ô∏è Copias de seguridad semanales</li>
      <li>üåç Acceso desde cualquier dispositivo</li>
      </ul>
      <div class="barra-popularidad">
        <div class="progreso" style="width: 50%;"></div>
      </div>
      <button title="Ideal para proyectos cortos" aria-label="Seleccionar plan 2 meses" onclick="mostrarModal('Plan 2 Meses')">Seleccionar</button>
    </article>
    
    <!-- Plan 5 Meses (Recomendado) -->
    <article class="plan recomendado" aria-label="Plan 5 Meses">
      <div class="etiqueta">‚≠ê Recomendado</div>
      <img src="https://img.icons8.com/emoji/48/star-emoji.png" alt="Icono del plan 5 meses recomendado" style="margin: 0 auto 10px;" />
      <h2>Plan 5 Meses</h2>
      <div class="precio">$2500 / 5 meses</div>
      <ul>
       <li>‚úÖ Acceso completo a la base de datos</li>
      <li>üíæ 50 GB de almacenamiento</li>
      <li>üîí Seguridad avanzada</li>
      <li>üì° API con mayor capacidad de consultas</li>
      <li>üìä Panel de control profesional</li>
      <li>üë• Hasta 5 usuarios administradores</li>
      <li>üõ†Ô∏è Copias de seguridad cada 48 horas</li>
      <li>üöÄ Optimizaci√≥n de rendimiento</li>
      <li>üìû Soporte t√©cnico prioritario</li>
      </ul>
      <div class="barra-popularidad">
        <div class="progreso" style="width: 85%;"></div>
      </div>
      <button title="Mejor opci√≥n 5 meses" aria-label="Seleccionar plan 5 meses" onclick="mostrarModal('Plan 5 Meses')">Seleccionar</button>
    </article>
    
    <!-- Plan 1 A√±o -->
    <article class="plan" aria-label="Plan 1 A√±o">
      <img src="https://img.icons8.com/emoji/48/check-mark-emoji.png" alt="Icono de plan 1 a√±o" style="margin: 0 auto 10px;" />
      <h2>Plan Anual</h2>
      <div class="precio">$5000 / a√±o</div>
      <ul>
         <li>‚úÖ Acceso ilimitado a la base de datos</li>
      <li>üíæ 200 GB de almacenamiento</li>
      <li>üîí Seguridad premium con cifrado avanzado</li>
      <li>üì° API ilimitada con escalabilidad autom√°tica</li>
      <li>üìä Panel de control empresarial</li>
      <li>üë• Hasta 20 usuarios administradores</li>
      <li>üõ†Ô∏è Copias de seguridad diarias</li>
      <li>üåç Redundancia multinube (m√°xima disponibilidad)</li>
      <li>üöÄ Rendimiento ultra optimizado</li>
      <li>üìû Soporte premium 24/7</li>
      </ul>
      <div class="barra-popularidad">
        <div class="progreso" style="width: 95%;"></div>
      </div>
      <button title="Ideal para largo plazo" aria-label="Seleccionar plan 1 a√±o" onclick="mostrarModal('Plan 1 A√±o')">Seleccionar</button>
    </article>
  </main>
  
  <!-- Avatar y mensaje de IA Alfa -->
  <aside class="alfa-avatar">
    <div class="alfa-bubble" id="mensajeAlfa">üí° Elige el plan de base de datos que m√°s se adapte a tu proyecto y disfruta de un servicio seguro y escalable.</div>
    <div id="avatarAnimacion" aria-hidden="true"></div>
  </aside>

  
  <!-- Modal de confirmaci√≥n -->
  <div id="modalConfirmacion" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitulo">
    <div class="modal-content">
      <h2 id="modalTitulo">A√±adir detalles de pago</h2>
      <p id="planSeleccionadoTexto" style="margin-bottom: 15px; font-size: 15px; opacity: 0.85;"></p>
      <p class="info">üí≥ A√±ade los datos de tu tarjeta de cr√©dito a continuaci√≥n. Esta tarjeta se procesar√° en Stripe de forma segura.</p>
      
      <form id="pagoForm">
        <label for="numero">N√∫mero de tarjeta</label>
        <input type="text" id="numero" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
  
        <div style="display: flex; gap: 10px;">
          <input type="text" placeholder="MM / AA" required style="flex: 1;" />
          <input type="text" placeholder="CVC" required style="flex: 1;" />
        </div>
  
        <label for="nombre">Nombre en la tarjeta</label>
        <input type="text" id="nombre" placeholder="Nombre completo" required />
  
        <label for="pais">Direcci√≥n de facturaci√≥n</label>
        <select id="pais" required>
          <option value="">Pa√≠s</option>
          <option value="mx">M√©xico</option>
          <option value="us">Estados Unidos</option>
          <option value="es">Espa√±a</option>
        </select>
  
        <input type="text" placeholder="L√≠nea de direcci√≥n 1" required />
        <input type="text" placeholder="L√≠nea de direcci√≥n 2 (opcional)" />
  
        <div style="display: flex; gap: 10px;">
          <input type="text" placeholder="Ciudad" required style="flex: 1;" />
          <input type="text" placeholder="C√≥digo postal" required style="flex: 1;" />
        </div>
  
        <input type="text" placeholder="Estado, provincia o regi√≥n" />
  
       
        <div style="display: flex; justify-content: flex-end; margin-top: 20px; gap: 10px;">
          <button type="button" class="cancelar" onclick="cerrarModal()">Cancelar</button>
          <button type="submit" class="continuar">Continuar</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA1qb1Aw2I4U-3nn3Iazrsw_RxoE2ZxvUE",
      authDomain: "ia-alfa.firebaseapp.com",
      projectId: "ia-alfa",
      storageBucket: "ia-alfa.appspot.com",
      messagingSenderId: "30859561655",
      appId: "1:30859561655:web:714ab0eb70fd22d9f85b32",
      measurementId: "G-5TG3F54YD7"
    };
  
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
  
    // Guardar plan seleccionado en Firestore
    async function guardarPlanEnFirestore(plan) {
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const uid = user.uid;
          const userRef = doc(db, "usuarios", uid);
          await updateDoc(userRef, { plan: plan });
          console.log("‚úÖ Plan guardado:", plan);
        } else {
          console.warn("‚ö†Ô∏è Usuario no autenticado");
        }
      });
    }
  
    window.guardarPlanEnFirestore = guardarPlanEnFirestore;
  
    // Lottie Avatar
    lottie.loadAnimation({
      container: document.getElementById("avatarAnimacion"),
      renderer: 'svg',
      loop: true,
      autoplay: true,
      path: "avatar.json"
    });
  
    // Lottie fondo
    lottie.loadAnimation({
      container: document.getElementById("lottieFondo"),
      renderer: "svg",
      loop: true,
      autoplay: true,
      path: "https://assets2.lottiefiles.com/packages/lf20_kkflmtur.json"
    });
  
    // Voz bienvenida
    const texto = "Elige el plan que m√°s se adapte a tus necesidades y empieza a crecer con IA Alfa.";
    const voz = new SpeechSynthesisUtterance(texto);
    voz.lang = "es-MX";
    voz.pitch = 1;
    voz.rate = 1;
    speechSynthesis.speak(voz);
  
    // Variables de modal
    let planSeleccionado = '';
    const modal = document.getElementById('modalConfirmacion');
  
    window.mostrarModal = function(plan) {
      planSeleccionado = plan;
      document.getElementById('planSeleccionadoTexto').textContent = 'Est√°s por suscribirte al ' + plan + '.';
      modal.classList.add('show');
    };
  
    function cerrarModal() {
      modal.classList.remove('show');
      planSeleccionado = '';
    }
  
    function confirmarPlan() {
      cerrarModal();
      alert('Has confirmado: ' + planSeleccionado);
    }
  
    // Stripe Checkout
    const stripe = Stripe("pk_live_51RROYJDtB6jnYBo4lvfLUeHYMVoVsI8jSeEhgDKJQjF6wAvtwuuFtIpg3J4BeejQ7j6x2DFClGksIpJgCHtPyNeG00YEPGZp6H");
  
    document.getElementById("pagoForm").addEventListener("submit", async (e) => {
      e.preventDefault();
  
      if (!planSeleccionado) {
        alert("Selecciona un plan antes de continuar.");
        return;
      }
  
      // Guardar en Firestore
      await guardarPlanEnFirestore(planSeleccionado);
  
      // Si es gratuito, redirige sin pago
      if (planSeleccionado === "Plan Gratuito") {
        alert("‚úÖ Suscripci√≥n gratuita activada. ¬°Bienvenido!");
        cerrarModal();
        window.location.href = "loading.html";
        return;
      }
  
      let precio = 0;
      if (planSeleccionado === "Plan Mensual") precio = 25000;
      if (planSeleccionado === "Plan Trimestral") precio = 60000;
  
      try {
        const response = await fetch("http://localhost:3000/crear-sesion", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ plan: planSeleccionado, precio: precio })
        });
  
        const data = await response.json();
        stripe.redirectToCheckout({ sessionId: data.id });
      } catch (error) {
        console.error("‚ùå Error con Stripe:", error);
        alert("‚ùå No se pudo procesar el pago.");
      }
    });
  
    // Cerrar modal funci√≥n p√∫blica
    window.cerrarModal = cerrarModal;
  
  </script>
  
</body>
</html>
